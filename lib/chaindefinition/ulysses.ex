defmodule ChainDefinition.Ulysses do
  alias Chain.{State, Account}

  def apply(%State{} = state) do
    Enum.reduce(patch(), state, fn account, state ->
      id = Base16.decode(account["addr"])
      code = Base16.decode(account["code"])
      acc = State.ensure_account(state, id)
      acc = %Account{acc | code: code, root_hash: nil}
      State.set_account(state, id, acc)
    end)
  end

  def patch() do
    [
      %{
        "addr" => "0x5000000000000000000000000000000000000000",
        "code" =>
          "0x6080604052600436106101405760003560e01c80638da08564116100b6578063c487e3f71161006f578063c487e3f714610362578063c4a9e1161461036a578063c76a11731461037f578063cb106cf81461039f578063f4b74016146103b4578063f595416f146103d457610140565b80638da08564146102ab5780638e0383a4146102c057806399ab110d146102ed578063b0128d921461030d578063b540f8941461032d578063be3bb93c1461034257610140565b8063534a242211610108578063534a2422146101e957806365c68de5146101fc5780636f9874a4146102295780637b4a927a1461023e5780637fca4a291461026b57806383d8a80f1461028b57610140565b80630a938dff146101455780630ac168a11461017b5780631b3b98c8146101925780631dd44706146101b257806345780f5f146101c7575b600080fd5b34801561015157600080fd5b50610165610160366004612887565b6103e9565b6040516101729190612c01565b60405180910390f35b34801561018757600080fd5b506101906104aa565b005b34801561019e57600080fd5b506101906101ad366004612798565b610528565b3480156101be57600080fd5b5061019061073a565b3480156101d357600080fd5b506101dc6108b6565b60405161017291906128b6565b6101906101f7366004612672565b610918565b34801561020857600080fd5b5061021c61021736600461271d565b610aba565b6040516101729190612b6a565b34801561023557600080fd5b50610165610c34565b34801561024a57600080fd5b5061025e610259366004612780565b610c47565b60405161017291906128a2565b34801561027757600080fd5b50610190610286366004612672565b610c71565b34801561029757600080fd5b506101906102a6366004612866565b610f13565b3480156102b757600080fd5b50610165610f89565b3480156102cc57600080fd5b506102e06102db366004612672565b610f8f565b6040516101729190612aef565b3480156102f957600080fd5b5061019061030836600461268e565b61103b565b34801561031957600080fd5b50610190610328366004612780565b611178565b34801561033957600080fd5b50610165611269565b34801561034e57600080fd5b5061016561035d366004612887565b61126f565b610190611282565b34801561037657600080fd5b5061016561128c565b34801561038b57600080fd5b5061019061039a366004612755565b611292565b3480156103ab57600080fd5b50610165611435565b3480156103c057600080fd5b5061025e6103cf366004612672565b61143b565b3480156103e057600080fd5b50610165611456565b600060ff831661040b576104046103ff8361145c565b6114d6565b90506104a4565b8260ff1660011415610428576104046104238361145c565b6114e5565b8260ff1660021415610445576104046104408361145c565b6114f4565b8260ff16600314156104625761040461045d8361145c565b611503565b6040805162461bcd60e51b8152602060048201526012602482015271155b9a185b991b195908185c99dd5b595b9d60721b604482015290519081900360640190fd5b92915050565b3341148015906104b957504115155b80156104ee5750336001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001614155b1561051b5733411461051b5760405162461bcd60e51b815260040161051290612a3e565b60405180910390fd5b610526600080611512565b565b864381106105485760405162461bcd60e51b815260040161051290612a8e565b6007546000190161055b82619d8061176f565b146105785760405162461bcd60e51b8152600401610512906129a3565b8484176105975760405162461bcd60e51b815260040161051290612a10565b60408051600680825260e082019092526000916020820160c0803683370190505090508840816000815181106105c957fe5b6020026020010181815250506105de886117b1565b816001815181106105eb57fe5b602002602001018181525050610600876117b1565b8160028151811061060d57fe5b6020026020010181815250508560001b8160038151811061062a57fe5b6020026020010181815250508460001b8160048151811061064757fe5b602002602001018181525050838160058151811061066157fe5b6020026020010181815250506000600161067a836117b4565b60408087015187516020808a01518451600081529091019384905261069f9493612903565b6020604051602081039080840390855afa1580156106c1573d6000803e3d6000fd5b5050506020604051035190506106d7898261180e565b6106e48989838a8a6118c2565b806001600160a01b0316886001600160a01b03168a6001600160a01b03167fc21a4132cfb2e72d1dd6f45bcb2dabb1722a19b036c895975db93175b1c5c06f60405160405180910390a450505050505050505050565b336000818152600560208181526040808420815160a0810183528154818401908152600183015460608084019190915260028401546080840152908252835190810184526003830154815260048301548186015291909401549181019190915290820152906107a882611503565b9050600081116107f2576040805162461bcd60e51b815260206004820152601060248201526f043616e277420776974686472617720360841b604482015290519081900360640190fd5b6107fc8282611a85565b6001600160a01b0384166000818152600560208181526040808420865180518255808401516001830155820151600282015595820151805160038801559182015160048701559081015194909101939093559151909183156108fc02918491818181858888f19350505050158015610878573d6000803e3d6000fd5b5060405181906001600160a01b038516906000907f7f22ec7a37a3fa31352373081b22bb38e1e0abd2a05b181ee7138a360edd3e1a908290a4505050565b6060600a80548060200260200160405190810160405280929190818152602001828054801561090e57602002820191906000526020600020905b81546001600160a01b031681526001909101906020018083116108f0575b5050505050905090565b8061092281611b02565b610973576040805162461bcd60e51b815260206004820152601e60248201527f496e76616c696420666c65657420636f6e747261637420616464726573730000604482015290519081900360640190fd5b6000816001600160a01b031663bcea317f6040518163ffffffff1660e01b815260040160206040518083038186803b1580156109ae57600080fd5b505afa1580156109c2573d6000803e3d6000fd5b505050506040513d60208110156109d857600080fd5b505190506001600160a01b0381163314610a235760405162461bcd60e51b8152600401808060200182810382526025815260200180612c206025913960400191505060405180910390fd5b610a3634610a308561145c565b90611b3e565b6001600160a01b038416600081815260066020908152604080832085518051825580840151600180840191909155908301516002830155958301518051600383015592830151600482015591810151600590920191909155513493917fd859864511fd3f512da77fc95a8c013b3a0e49bdface8f574b2df8527cecea7191a4505050565b610ac2612586565b6000610acd84611b5b565b6001600160a01b038416600081815260048301602090815260408083206003810154825160808101845295865260018201549386019390935260028101549185019190915293945091606081018367ffffffffffffffff81118015610b3157600080fd5b50604051908082528060200260200182016040528015610b6b57816020015b610b586125b7565b815260200190600190039081610b505790505b509052905060005b82811015610c29576000846003018281548110610b8c57fe5b60009182526020808320909101546001600160a01b03168083526004880182526040928390208351608081018552815460ff1615158152600182015481850152600282015481860190815260039092015460608083019182528651808201885285815293519584019590955251948201949094529186015180519194509085908110610c1457fe5b60209081029190910101525050600101610b73565b509695505050505050565b6000610c4243619d8061176f565b905090565b60088181548110610c5757600080fd5b6000918252602090912001546001600160a01b0316905081565b80610c7b81611b02565b610ccc576040805162461bcd60e51b815260206004820152601e60248201527f496e76616c696420666c65657420636f6e747261637420616464726573730000604482015290519081900360640190fd5b6000816001600160a01b031663bcea317f6040518163ffffffff1660e01b815260040160206040518083038186803b158015610d0757600080fd5b505afa158015610d1b573d6000803e3d6000fd5b505050506040513d6020811015610d3157600080fd5b505190506001600160a01b0381163314610d7c5760405162461bcd60e51b8152600401808060200182810382526025815260200180612c206025913960400191505060405180910390fd5b6000836001600160a01b031663bcea317f6040518163ffffffff1660e01b815260040160206040518083038186803b158015610db757600080fd5b505afa158015610dcb573d6000803e3d6000fd5b505050506040513d6020811015610de157600080fd5b505190506000610df08561145c565b90506000610dfd82611503565b905060008111610e47576040805162461bcd60e51b815260206004820152601060248201526f043616e277420776974686472617720360841b604482015290519081900360640190fd5b610e518282611a85565b6001600160a01b038088166000908152600660209081526040808320855180518255808401516001830155820151600282015594820151805160038701559182015160048601559081015160059094019390935591519085169183156108fc02918491818181858888f19350505050158015610ed1573d6000803e3d6000fd5b5060405181906001600160a01b038816906001907f7f22ec7a37a3fa31352373081b22bb38e1e0abd2a05b181ee7138a360edd3e1a90600090a4505050505050565b334114801590610f2257504115155b8015610f575750336001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001614155b15610f7b57334114610f7b5760405162461bcd60e51b815260040161051290612a3e565b610f858282611512565b5050565b60075490565b610f97612586565b6000610fa283611b5b565b90506040518060800160405280846001600160a01b0316815260200182600101548152602001826002015481526020018260030180548060200260200160405190810160405280929190818152602001828054801561102a57602002820191906000526020600020905b81546001600160a01b0316815260019091019060200180831161100c575b50505050508152509150505b919050565b80158061104a57506009810615155b156110675760405162461bcd60e51b815260040161051290612974565b60005b81811015611173576000604051806060016040528085858560060181811061108e57fe5b9050602002013581526020018585856007018181106110a957fe5b9050602002013581526020018585856008018181106110c457fe5b90506020020135815250905061116a8484846000018181106110e257fe5b9050602002013560001c61110a8686866001018181106110fe57fe5b905060200201356117b1565b61111c8787876002018181106110fe57fe5b87878760030181811061112b57fe5b9050602002013560001c88888860040181811061114457fe5b9050602002013560001c89898960050181811061115d57fe5b9050602002013587610528565b5060090161106a565b505050565b33600081815260056020818152604092839020835160a081018552815481860190815260018301546060808401919091526002840154608084015290825285519081018652600383015481526004830154818501529190930154938101939093528101919091526111e99083611b75565b6001600160a01b03821660008181526005602081815260408084208651805182558084015160018301558201516002820155958201518051600388015591820151600487015590810151949091019390935591518492907f81149c79fef0028ec92e02ee17f72b9bba024dce75220cba8d62f7bbcd0922b6908290a45050565b600d5490565b600061127b8383611be5565b9392505050565b6105263334611df7565b60025481565b8161129c81611b02565b6112ed576040805162461bcd60e51b815260206004820152601e60248201527f496e76616c696420666c65657420636f6e747261637420616464726573730000604482015290519081900360640190fd5b6000816001600160a01b031663bcea317f6040518163ffffffff1660e01b815260040160206040518083038186803b15801561132857600080fd5b505afa15801561133c573d6000803e3d6000fd5b505050506040513d602081101561135257600080fd5b505190506001600160a01b038116331461139d5760405162461bcd60e51b8152600401808060200182810382526025815260200180612c206025913960400191505060405180910390fd5b6113b0836113aa8661145c565b90611b75565b6001600160a01b038516600081815260066020908152604080832085518051825580840151600180840191909155908301516002830155958301518051600383015592830151600482015591810151600590920191909155518693917f81149c79fef0028ec92e02ee17f72b9bba024dce75220cba8d62f7bbcd0922b691a450505050565b60035481565b6004602052600090815260409020546001600160a01b031681565b600c5490565b6114646125e1565b506001600160a01b0316600090815260066020908152604091829020825160a08101845281548185019081526001830154606080840191909152600284015460808401529082528451908101855260038301548152600483015481850152600590920154938201939093529082015290565b60006104a48260000151611ef1565b60006104a48260000151611f08565b60006104a48260200151611f08565b60006104a48260200151611ef1565b61151a610c34565b6007541461152a5761152a611f1c565b600d54820281101561154e5760405162461bcd60e51b8152600401610512906129c8565b600c8054600a9083019081049081900390915567016345785d8a0000016115804161157b83612710612154565b6121ad565b6001600160a01b037f0000000000000000000000001000000000000000000000000000000000000000166108fc6115b883600a61176f565b6040518115909202916000818181858888f193505050501580156115e0573d6000803e3d6000fd5b50506301312d0082106116055760405162461bcd60e51b815260040161051290612ac5565b629896808210611641576008600d548161161b57fe5b04600d600082825401925050819055506064600d54101561163c576064600d555b611674565b624c4b408211611674576008600d548161165757fe5b600d8054929091049091039081905560641115611674576000600d555b60005b6008548110156117625760006008828154811061169057fe5b60009182526020808320909101546001600160a01b0316808352600990915260408220549092506116c39061271061176f565b905060006116d2600084611be5565b905066038d7ea4c680008110156116ed575066038d7ea4c680005b808211156116f9578091505b811561174057611709838361225c565b60405182906001600160a01b038516907fc083a1647e3ee591bf42b82564ffb4d16fdbb26068f0080da911c8d8300fd84a90600090a35b50506001600160a01b0316600090815260096020526040812055600101611677565b50610f8560086000612606565b600061127b83836040518060400160405280601a81526020017f536166654d6174683a206469766973696f6e206279207a65726f00000000000081525061232b565b90565b60008160405160200180828051906020019060200280838360005b838110156117e75781810151838201526020016117cf565b50505050905001915050604051602081830303815290604052805190602001209050919050565b60405163d90bd65160e01b81528290611173906001600160a01b0383169063d90bd651906118409086906004016128a2565b60206040518083038186803b15801561185857600080fd5b505afa15801561186c573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061189091906126fd565b60405180604001604052806013815260200172556e726567697374657265642064657669636560681b815250846123cd565b60006118cd86611b5b565b805490915060ff1661192f578054600160ff1990911681178255600a805491820181556000527fc65a7bb8d6351c1cf70c95a316cc6a92839c986682d98bc35f958f4883f9d2a80180546001600160a01b0319166001600160a01b0388161790555b6001600160a01b03851660009081526004820160205260409020805460ff1661198f578054600160ff199091168117825560038301805491820181556000908152602090200180546001600160a01b0319166001600160a01b0388161790555b6001600160a01b03851660009081526004820160205260409020805460ff166119ef578054600160ff199091168117825560038301805491820181556000908152602090200180546001600160a01b0319166001600160a01b0388161790555b8060020154851115611a355760028101805490869055600183015490860390611a1890826123f2565b600180850191909155840154611a2e90826123f2565b6001850155505b8060030154841115611a7b5760038101805490859055600283015490850390611a5e90826123f2565b600280850191909155840154611a7490826123f2565b6002850155505b5050505050505050565b611a8d6125e1565b81611a9b8460200151611ef1565b1015611ae7576040805162461bcd60e51b8152602060048201526016602482015275496e737566666963656e742066726565207374616b6560501b604482015290519081900360640190fd5b6020830151611af6908361244c565b60208401525090919050565b6000813f7fc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470818114801590611b3657508115155b949350505050565b611b466125e1565b8251611b5290836124cc565b83525090919050565b6001600160a01b03166000908152600b6020526040902090565b611b7d6125e1565b81611b8b8460000151611ef1565b1015611bc85760405162461bcd60e51b8152600401808060200182810382526021815260200180612c666021913960400191505060405180910390fd5b8251611bd4908361244c565b83526020830151611af690836124cc565b600060ff8316611c68576001600160a01b038216600090815260056020818152604092839020835160a08101855281548186019081526001830154606080840191909152600284015460808401529082528551908101865260038301548152600483015481850152919093015493810193909352810191909152610404906114d6565b8260ff1660011415611ced576001600160a01b038216600090815260056020818152604092839020835160a08101855281548186019081526001830154606080840191909152600284015460808401529082528551908101865260038301548152600483015481850152919093015493810193909352810191909152610404906114e5565b8260ff1660021415611d72576001600160a01b038216600090815260056020818152604092839020835160a08101855281548186019081526001830154606080840191909152600284015460808401529082528551908101865260038301548152600483015481850152919093015493810193909352810191909152610404906114f4565b8260ff1660031415610462576001600160a01b038216600090815260056020818152604092839020835160a0810185528154818601908152600183015460608084019190915260028401546080840152908252855190810186526003830154815260048301548185015291909301549381019390935281019190915261040490611503565b6001600160a01b038216600090815260056020818152604092839020835160a08101855281548186019081526001830154606080840191909152600284015460808401529082528551908101865260038301548152600483015481850152919093015493810193909352810191909152611e719082611b3e565b6001600160a01b03831660008181526005602081815260408084208651805182558084015160018301558201516002820155958201518051600388015591820151600487015590810151949091019390935591518392907fd859864511fd3f512da77fc95a8c013b3a0e49bdface8f574b2df8527cecea71908290a45050565b6000611efe8260006124cc565b6040015192915050565b6000611f158260006124cc565b5192915050565b60008060005b600a54811015612138576000600a8281548110611f3b57fe5b60009182526020822001546001600160a01b03169150611f5a82612542565b9050611f6781606461176f565b93506000611f7483611b5b565b90506000611f9f611f94610400846001015461215490919063ffffffff16565b6002840154906123f2565b905060005b60038301548110156120e957826003018181548110611fbf57fe5b60009182526020808320909101546001600160a01b031680835260048601909152604082206001810154919a509190611ffe90611f9490610400612154565b90506120208461201a8b61201485612710612154565b90612154565b9061176f565b905061202c8a826121ad565b60005b600383015481101561209a5782600401600084600301838154811061205057fe5b60009182526020808320909101546001600160a01b031683528201929092526040018120805460ff191681556001818101839055600282018390556003909101919091550161202f565b506001600160a01b038a1660009081526004860160205260408120805460ff191681556001810182905560028101829055906120d96003830182612606565b505060019092019150611fa49050565b506001600160a01b0384166000908152600b60205260408120805460ff191681556001810182905560028101829055906121266003830182612606565b505060019094019350611f2292505050565b612144600a6000612606565b61214c610c34565b600755505050565b600082612163575060006104a4565b8282028284828161217057fe5b041461127b5760405162461bcd60e51b8152600401808060200182810382526021815260200180612c456021913960400191505060405180910390fd5b8015610f85576001600160a01b03821660009081526009602052604090205461221c57600880546001810182556000919091527ff3f7a9fe364faab93b216da50a3214154f22a0a2b415b23a84c8169e8b636ee30180546001600160a01b0319166001600160a01b0384161790555b6001600160a01b03821660009081526009602052604090205461223f90826123f2565b6001600160a01b0383166000908152600960205260409020555050565b6001600160a01b038216600090815260056020818152604092839020835160a081018552815481860190815260018301546060808401919091526002840154608084015290825285519081018652600383015481526004830154818501529190930154938101939093528101919091526122d69082612550565b6001600160a01b03909216600090815260056020818152604092839020855180518255808301516001830155840151600282015594810151805160038701559081015160048601559091015192019190915550565b600081836123b75760405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b8381101561237c578181015183820152602001612364565b50505050905090810190601f1680156123a95780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b5060008385816123c357fe5b0495945050505050565b81836123ec5760405162461bcd60e51b81526004016105129190612921565b50505050565b60008282018381101561127b576040805162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604482015290519081900360640190fd5b612454612627565b61245f8360006124cc565b905081816040015110156124ba576040805162461bcd60e51b815260206004820152601b60248201527f496e737566666963656e742066756e647320746f206465647563740000000000604482015290519081900360640190fd5b60408101805192909203909152919050565b6124d4612627565b6124dd83612575565b61251157604080516060810182528381524360208201528451858301519192830191612508916123f2565b905290506104a4565b60408051606081019091528351819061252a90856123f2565b815243602082015260408581015191015290506104a4565b60006104a46103ff8361145c565b6125586125e1565b82516040015161256890836123f2565b8351604001525090919050565b602001516202ac6043919091031090565b604051806080016040528060006001600160a01b031681526020016000815260200160008152602001606081525090565b604051806060016040528060006001600160a01b0316815260200160008152602001600081525090565b60405180604001604052806125f4612627565b8152602001612601612627565b905290565b50805460008255906000526020600020908101906126249190612648565b50565b60405180606001604052806000815260200160008152602001600081525090565b5b8082111561265d5760008155600101612649565b5090565b803560ff8116811461103657600080fd5b600060208284031215612683578081fd5b813561127b81612c0a565b600080602083850312156126a0578081fd5b823567ffffffffffffffff808211156126b7578283fd5b818501915085601f8301126126ca578283fd5b8135818111156126d8578384fd5b86602080830285010111156126eb578384fd5b60209290920196919550909350505050565b60006020828403121561270e578081fd5b8151801515811461127b578182fd5b6000806040838503121561272f578182fd5b823561273a81612c0a565b9150602083013561274a81612c0a565b809150509250929050565b60008060408385031215612767578182fd5b823561277281612c0a565b946020939093013593505050565b600060208284031215612791578081fd5b5035919050565b600080600080600080600061012080898b0312156127b4578384fd5b883597506020808a01356127c781612c0a565b975060408a01356127d781612c0a565b965060608a0135955060808a0135945060a08a0135935060df8a018b136127fc578283fd5b6040516060810181811067ffffffffffffffff8211171561281957fe5b6040528060c08c01848d018e101561282f578586fd5b8594505b6003851015612852578035825260019490940193908301908301612833565b505080935050505092959891949750929550565b60008060408385031215612878578182fd5b50508035926020909101359150565b60008060408385031215612899578182fd5b61273a83612661565b6001600160a01b0391909116815260200190565b6020808252825182820181905260009190848201906040850190845b818110156128f75783516001600160a01b0316835292840192918401916001016128d2565b50909695505050505050565b93845260ff9290921660208401526040830152606082015260800190565b6000602080835283518082850152825b8181101561294d57858101830151858201604001528201612931565b8181111561295e5783604083870101525b50601f01601f1916929092016040019392505050565b602080825260159082015274092dcecc2d8d2c840e8d2c6d6cae840d8cadccee8d605b1b604082015260600190565b6020808252600b908201526a0aee4dedcce40cae0dec6d60ab1b604082015260600190565b60208082526028908201527f41766572616765206761732070726963652062656c6f772063757272656e7420604082015267626173652066656560c01b606082015260800190565b602080825260149082015273496e76616c6964207469636b65742076616c756560601b604082015260600190565b60208082526030908201527f4f6e6c7920746865206d696e6572206f662074686520626c6f636b2063616e2060408201526f18d85b1b081d1a1a5cc81b595d1a1bd960821b606082015260800190565b60208082526017908201527f5469636b65742066726f6d20746865206675747572653f000000000000000000604082015260600190565b60208082526010908201526f426c6f636b20697320746f6f2062696760801b604082015260600190565b6000602080835260a0830160018060a01b03808651168386015282860151604086015260408601516060860152606086015160808087015282815180855260c08801915085830194508692505b80831015612b5e57845184168252938501936001929092019190850190612b3c565b50979650505050505050565b602080825282516001600160a01b0390811683830152838201516040808501919091528085015160608086019190915280860151608080870152805160a087018190526000959491850193919286929160c08901905b80851015612bf3578651805187168352888101518984015284015184830152958701956001949094019390820190612bc0565b509998505050505050505050565b90815260200190565b6001600160a01b038116811461262457600080fdfe4f6e6c792074686520666c656574206163636f756e74616e742063616e20646f2074686973536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f7743616e277420756e7374616b65206d6f7265207468616e206973207374616b6564a264697066735822122001daaaa36e483912e4dcefd47ff97b14d3c2cc353ae9ecb512a1fa78686ed23664736f6c63430007060033"
      }
    ]
  end
end
